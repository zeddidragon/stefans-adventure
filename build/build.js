(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var AStar,NEIGHBORS;NEIGHBORS=[[0,1],[0,-1],[1,0],[-1,0]];module.exports=AStar=function(){function AStar(grid){this.grid=grid}AStar.prototype.path=function(start,dest,opts){var closed,closest,count,deadzone,max,node,nodes,previous,stack;if(opts==null){opts={}}start.distance=this.distance(start,dest);start.cost=0;stack=[start];closed={};closed[start]=false;previous=null;closest=start;max=opts.max||Infinity;deadzone=opts.deadzone||0;count=0;while(stack.length){node=stack.pop();previous=node;if(node.distance<closest.distance){closest=node}nodes=this.neighbors(node).filter(function(n){return node.cost<max&&closed[n]==null}).map(function(_this){return function(n){closed[n]=node;n.cost=node.cost+1;n.distance=_this.distance(n,dest);return n}}(this));stack=stack.concat(nodes).sort(function(b,a){return a.distance+a.cost*2-b.distance-b.cost*2});if(deadzone>=this.distance(node,dest)){return this.makePath(closed,node)}}return this.makePath(closed,closest)};AStar.prototype.checkBounds=function(x,y){return 0<=y&&y<this.grid.length&&(0<=x&&x<=this.grid[y].length)};AStar.prototype.distance=function(a,b){return Math.abs(a[0]-b[0])+Math.abs(a[1]-b[1])};AStar.prototype.neighbors=function(node){return NEIGHBORS.map(function(n){return[node[0]+n[0],node[1]+n[1]]}).filter(function(_this){return function(n){return _this.checkBounds(n[0],n[1])&&!_this.grid[n[1]][n[0]]}}(this))};AStar.prototype.makePath=function(closed,node){var ret;ret=[node];while(node=closed[node]){ret.push(node)}return ret};return AStar}()},{}],2:[function(require,module,exports){module.exports=function(obj){if(typeof obj==="string")return camelCase(obj);return walk(obj)};function walk(obj){if(!obj||typeof obj!=="object")return obj;if(isDate(obj)||isRegex(obj))return obj;if(isArray(obj))return map(obj,walk);return reduce(objectKeys(obj),function(acc,key){var camel=camelCase(key);acc[camel]=walk(obj[key]);return acc},{})}function camelCase(str){return str.replace(/[_.-](\w|$)/g,function(_,x){return x.toUpperCase()})}var isArray=Array.isArray||function(obj){return Object.prototype.toString.call(obj)==="[object Array]"};var isDate=function(obj){return Object.prototype.toString.call(obj)==="[object Date]"};var isRegex=function(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"};var has=Object.prototype.hasOwnProperty;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(has.call(obj,key))keys.push(key)}return keys};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}function reduce(xs,f,acc){if(xs.reduce)return xs.reduce(f,acc);for(var i=0;i<xs.length;i++){acc=f(acc,xs[i],i)}return acc}},{}],3:[function(require,module,exports){var AnimatedSprite,events,makeFrames;makeFrames=require("../helper/make-frames");events=require("../events");module.exports=AnimatedSprite=function(){function AnimatedSprite(path,group){var animation,name,ref;this.path=path;this.sprite=group.create(0,0,"sprites");this.sprite.obj=this;this.animations=this.sprite.animations;this.scale=this.sprite.scale;this.sprite.anchor.setTo(.5,1);ref=makeFrames("actor",this.path);for(name in ref){animation=ref[name];this.animations.add(name,animation,8,true)}this.pos=this.sprite.position;this.animations.play("idle")}AnimatedSprite.prototype.animate=function(animation,frameCallbacks){return events.chain().link(events.animate(this,animation,frameCallbacks)).ensure(function(_this){return function(){return _this.animations.play("idle")}}(this))};AnimatedSprite.prototype.loop=function(animation,duration){return events.chain().link(events.loopAnimation(this,animation,duration)).ensure(function(_this){return function(){return _this.animations.play("idle")}}(this))};AnimatedSprite.prototype.destroy=function(){return room.remove(this)};AnimatedSprite.prototype.replaceWith=function(other){this.destroy();other.pos.copyFrom(this.pos);other.scale.copyFrom(this.scale);room.sortEntities();return other};return AnimatedSprite}()},{"../events":15,"../helper/make-frames":36}],4:[function(require,module,exports){var AnimatedSprite,MAX_Y,Path,Player,events,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;AnimatedSprite=require("../animated-sprite");Path=require("../../ai/path");events=require("../../events");MAX_Y=70;module.exports=Player=function(superClass){extend(Player,superClass);function Player(name){this.name=name;game.input.onDown.add(this.clickAction,this);Player.__super__.constructor.apply(this,arguments)}Player.prototype.handleKeyFrame=2;Player.prototype.clickAction=function(touch){var action,obj;if(globals.isControlsLocked){return}if(!(touch.position.y<MAX_Y)){return}this["break"]();obj=globals.ui.info.obj;action=globals.ui.actions.selected.name;return this.currentAction=this.chain().link(function(_this){return function(){if(obj){return obj.action(action,player,globals.ui.inventory.selected)}else{return _this.frolic(touch.position)}}}(this)).run()};Player.prototype["break"]=function(){var ref;return(ref=this.currentAction)!=null?ref["break"]():void 0};Player.prototype.frolic=function(pos){return this.chain().link(function(_this){return function(){return _this.sprite.animations.play("frolic")}}(this)).link(events.pathTo(this,pos,64))};Player.prototype.blab=function(string){return this.chain().link(function(_this){return function(){return _this.sprite.animations.play("blab")}}(this)).link(function(_this){return function(){return events.blab(string,_this)}}(this))};Player.prototype.handle=function(obj,callback){callback=this.toFrameCallbacks(callback);return obj.frolic(this).link(this.animate("handle",callback))};Player.prototype.work=function(obj,n){var i,j,ref,ret;if(n==null){n=3}ret=this.frolic(obj.pos);for(i=j=0,ref=n;j<=ref;i=j+=1){ret.link(this.animate("handle-crouch"))}return ret};Player.prototype.toFrameCallbacks=function(callback){if(callback==null){callback=[]}if(!Array.isArray(callback)){callback=[this.handleKeyFrame,callback]}return[callback]};Player.prototype.chain=function(link){return events.chain(link).ensure(function(_this){return function(){return _this.animations.play("idle")}}(this))};Player.prototype.cutscene=function(level){return this.chain().link(function(){return globals.ui.addLock(level)}).ensure(function(){return globals.ui.setLock(0)})};Player.prototype.dialogue=function(entity){return events.dialogue(this,entity)};Player.prototype.orient=function(obj){return this.scale.x=+(obj.facing==="right")*2-1};Player.prototype.destroy=function(){game.input.onDown.remove(this.clickAction,this);return Player.__super__.destroy.apply(this,arguments)};Object.defineProperty(Player.prototype,"x",{get:function(){return this.pos.x},set:function(v){if(this.pos.x!==v&&Math.sign(this.sprite.scale.x)===Math.sign(this.pos.x-v)){this.sprite.scale.x*=-1}return this.pos.x=v}});Object.defineProperty(Player.prototype,"y",{get:function(){return this.pos.y},set:function(v){if(this.pos.y!==v){room.sortEntities()}return this.pos.y=v}});return Player}(AnimatedSprite)},{"../../ai/path":8,"../../events":15,"../animated-sprite":3}],5:[function(require,module,exports){var Player,StefanDarkness,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Player=require("./player");module.exports=StefanDarkness=function(superClass){extend(StefanDarkness,superClass);function StefanDarkness(group){StefanDarkness.__super__.constructor.call(this,"stefan-darkness",group)}return StefanDarkness}(Player)},{"./player":4}],6:[function(require,module,exports){var Player,StefanNoCigarette,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Player=require("./player");module.exports=StefanNoCigarette=function(superClass){extend(StefanNoCigarette,superClass);function StefanNoCigarette(group){var path;path="stefan-no-cigarette";StefanNoCigarette.__super__.constructor.call(this,path,group);this.overlay=this.sprite;StefanNoCigarette.__super__.constructor.call(this,path,group);this.matchHand=this.sprite;StefanNoCigarette.__super__.constructor.call(this,path,group);this.matchHand.position=this.sprite.position;this.matchHand.scale=this.sprite.scale;this.matchHand.animations.play("match");this.overlay.position=this.sprite.position;this.overlay.scale=this.sprite.scale;this.overlay.visible=false;this.overlay.bringToTop()}StefanNoCigarette.prototype.blab=function(){return StefanNoCigarette.__super__.blab.apply(this,arguments).linkLeft(function(_this){return function(){_this.overlay.visible=true;_this.overlay.animations.play("blab-head");return _this.matchHand.visible=true}}(this)).ensure(function(_this){return function(){return _this.overlay.visible=false}}(this))};StefanNoCigarette.prototype.handle=function(obj,callbacks){callbacks=this.toFrameCallbacks(callbacks);return obj.frolic(this).link(function(_this){return function(){_this.matchHand.visible=false;return _this.animate("handle",callbacks)}}(this)).ensure(function(_this){return function(){return _this.matchHand.visible=true}}(this))};StefanNoCigarette.prototype.destroy=function(){this.overlay.destroy();this.matchHand.destroy();return StefanNoCigarette.__super__.destroy.apply(this,arguments)};return StefanNoCigarette}(Player)},{"./player":4}],7:[function(require,module,exports){var Player,Stefan,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Player=require("./player");module.exports=Stefan=function(superClass){extend(Stefan,superClass);function Stefan(group){var blabStart,frames,path;path="stefan";Stefan.__super__.constructor.call(this,path,group);this.overlay=this.sprite;Stefan.__super__.constructor.call(this,path,group);frames=this.animations._anims["blab-start"]._frames.slice().reverse();blabStart=this.animations._anims["blab-start"];blabStart.speed=16;frames=blabStart._frames.slice().reverse();this.animations.add("blab-stop",frames,16,false);this.animations;this.overlay.position=this.sprite.position;this.overlay.scale=this.sprite.scale;this.overlay.visible=false;this.overlay.bringToTop()}Stefan.prototype.blab=function(){return Stefan.__super__.blab.apply(this,arguments).linkLeft(this.animate("blab-start")).link(this.animate("blab-stop"))};return Stefan}(Player)},{"./player":4}],8:[function(require,module,exports){var MultiEvent,Path,TweenPath,arrayEqual,bezierDistance,toArr,toCoordArr;arrayEqual=require("../helper/array-equal");TweenPath=require("../events/tween-path");MultiEvent=require("../events/multi");toArr=function(coords,multiplier){return[coords.x,coords.y].map(function(coord){return Math.floor(coord/multiplier)})};toCoordArr=function(points,index,multiplier){return points.map(function(point){return(point[index]+.5)*multiplier}).reverse()};bezierDistance=function(xs,ys,resolution){var dist,distX,distY,i,j,newX,newY,prevX,prevY,progress,ref;if(resolution==null){resolution=2}dist=0;prevX=xs[0];prevY=ys[0];resolution*=xs.length;for(i=j=1,ref=resolution;j<=ref;i=j+=1){progress=i/resolution;newX=game.math.bezierInterpolation(xs,progress);newY=game.math.bezierInterpolation(ys,progress);distX=Math.abs(newX-prevX);distY=Math.abs(newY-prevY);prevX=newX;prevY=newY;dist+=distX+distY*2}return Math.sqrt(dist*dist)};module.exports=Path=function(){function Path(pathFinder,start,end,multiplier1){var points;this.multiplier=multiplier1!=null?multiplier1:1;start=toArr(start,this.multiplier);end=toArr(end,this.multiplier);points=pathFinder.path(start,end);this.x=toCoordArr(points,0,this.multiplier);this.y=toCoordArr(points,1,this.multiplier);this.success=arrayEqual(end,points[0])}Path.prototype.assign=function(position,speed){var length,opts,xTween,yTween;if(speed==null){speed=1}length=bezierDistance(this.x,this.y);opts={speed:speed/length};xTween=new TweenPath(position,"x",this.x,opts);yTween=new TweenPath(position,"y",this.y,opts);return new MultiEvent([xTween,yTween])};return Path}()},{"../events/multi":18,"../events/tween-path":22,"../helper/array-equal":31}],9:[function(require,module,exports){var Flags,Room,ScaleManager,Scanlines,Stefan,Ui,resize,transformPosition;resize=require("./helper/resize");transformPosition=require("./helper/transform-position");Scanlines=require("./filters/fakelines");Stefan=require("./actor/player/stefan-darkness");Room=require("./room");Ui=require("./ui");Flags=require("./globals/flags");ScaleManager=Phaser.ScaleManager;module.exports=function(){var stopper;window.globals=this;this.scanlines=new Scanlines;this.world=game.add.group();this.world.filters=[this.scanlines];stopper=game.add.image();stopper.position.y=140;this.world.add(stopper);this.ui=new Ui(this.world);this.ui.pos.y=70;this.room=changeRoom("stefans-garden");this.events=[];this.flags=new Flags;game.scale.fullScreenScaleMode=ScaleManager.SHOW_ALL;resize.call(this);window.addEventListener("resize",resize.bind(this));globals.sfx=game.add.audioSprite("sfx");return globals.sfx.allowMultiple=true}},{"./actor/player/stefan-darkness":5,"./filters/fakelines":26,"./globals/flags":30,"./helper/resize":37,"./helper/transform-position":40,"./room":47,"./ui":62}],10:[function(require,module,exports){var Animate,SceneEvent,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;SceneEvent=require("./base");module.exports=Animate=function(superClass){extend(Animate,superClass);function Animate(sprite,animation,callbacks){this.sprite=sprite;this.animation=animation;this.callbacks=callbacks!=null?callbacks:[];this.previous=null;Animate.__super__.constructor.apply(this,arguments)}Animate.prototype.run=function(){this.cycle=this.sprite.animations.play(this.animation,void 0,false);return Animate.__super__.run.apply(this,arguments)};Animate.prototype.atFrame=function(index,callback){this.callbacks.push([index,callback]);return this};Animate.prototype.update=function(){if(this.cycle._frameIndex!==this.previous){this.checkCallbacks()}this.previous=this.cycle._frameIndex;if(this.cycle.isFinished){return this.finish()}};Animate.prototype.checkCallbacks=function(){var base,callback,i,index,len,ref,ref1,results;ref=this.callbacks;results=[];for(i=0,len=ref.length;i<len;i++){ref1=ref[i],index=ref1[0],callback=ref1[1];if(this.cycle._frameIndex===index){results.push(typeof(base=(typeof callback==="function"?callback():void 0)||callback).run==="function"?base.run():void 0)}else{results.push(void 0)}}return results};return Animate}(SceneEvent)},{"./base":11}],11:[function(require,module,exports){var SceneEvent;module.exports=SceneEvent=function(){function SceneEvent(){}SceneEvent.prototype.run=function(callback1){this.callback=callback1;this.addToEvents();return this};SceneEvent.prototype.addToEvents=function(){var index;index=globals.events.indexOf(this);if(this.update&&index<0){return globals.events.push(this)}};SceneEvent.prototype.removeFromEvents=function(){var index;index=globals.events.indexOf(this);if(index<0){return}globals.events[index]=globals.events[globals.events.length-1];return globals.events.length-=1};SceneEvent.prototype["break"]=function(){this.removeFromEvents();delete this.callback;return this};SceneEvent.prototype.finish=function(){var callback;callback=this.callback;this["break"]();return typeof callback==="function"?callback():void 0};SceneEvent.prototype.fail=function(reason){this["break"]();throw reason};return SceneEvent}()},{}],12:[function(require,module,exports){var Blab,LockUi,capital,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;LockUi=require("./lock-ui");capital=require("../helper/capital");module.exports=Blab=function(superClass){extend(Blab,superClass);function Blab(strings,entity){this.strings=strings;this.entity=entity;if(!Array.isArray(this.strings)){this.strings=[this.strings]}this.strings=this.strings.slice().reverse();this.label=null;this.text=null}Blab.prototype.run=function(){game.input.onDown.add(this.next,this);if(globals.isControlsLocked===2){this.label=new BmText(globals.ui.group,0,0,capital(this.entity.name))}this.text=new BmText(globals.ui.group,10,10,"",{maxWidth:180});this.next();return Blab.__super__.run.apply(this,arguments)};Blab.prototype.next=function(){var string;string=this.strings.pop();if(!string){return this.finish()}return this.text.content=string};Blab.prototype["break"]=function(){var ref;game.input.onDown.remove(this.next,this);this.text.destroy();if((ref=this.label)!=null){ref.destroy()}return Blab.__super__["break"].apply(this,arguments)};return Blab}(LockUi)},{"../helper/capital":32,"./lock-ui":16}],13:[function(require,module,exports){var EventChain,SceneEvent,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;SceneEvent=require("./base");module.exports=EventChain=function(superClass){extend(EventChain,superClass);function EventChain(chain){this.chain=chain!=null?chain:[];if(!Array.isArray(this.chain)){this.chain=[this.chain]}this.ensured=[];this.linkCallback=this.next.bind(this);this.state=0}EventChain.prototype.link=function(link){this.chain.push(link);return this};EventChain.prototype.linkLeft=function(link){this.chain.unshift(link);return this};EventChain.prototype.ensure=function(ensured){this.ensured.push(ensured);return this};EventChain.prototype.run=function(){EventChain.__super__.run.apply(this,arguments);if(this.state){return}this.state=1;return this.next()};EventChain.prototype.next=function(){var link,ref;if(!this.chain.length){return this.finish()}link=this.chain.shift();this.activeLink=(typeof link==="function"?link():void 0)||link;if((ref=this.activeLink)!=null?ref.run:void 0){this.activeLink.run(this.linkCallback)}else{this.next()}return this};EventChain.prototype["break"]=function(){var cb,i,len,ref,ref1;this.state=2;if((ref=this.activeLink)!=null){if(typeof ref["break"]==="function"){ref["break"]()}}ref1=this.ensured;for(i=0,len=ref1.length;i<len;i++){cb=ref1[i];cb()}return EventChain.__super__["break"].apply(this,arguments)};return EventChain}(SceneEvent)},{"./base":11}],14:[function(require,module,exports){var Dialogue,LockUi,getDialogue,interpolate,invoke,selectable,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;LockUi=require("./lock-ui");selectable=require("../ui/widgets/selectable");getDialogue=require("../helper/get-dialogue");invoke=require("../helper/invoke");interpolate=require("../helper/string-interpolation");module.exports=Dialogue=function(superClass){extend(Dialogue,superClass);function Dialogue(player,entity){this.player=player;this.entity=entity;window.dialogue=this;this.options={};this.context=["dialogue",globals.room.path,this.entity.name].join("/");this.state=0}Dialogue.prototype.option=function(key,opts,callback){if(opts==null){opts={}}if(typeof opts==="function"){callback=opts;opts={}}this.options[key]=[opts,callback];return this};Dialogue.prototype.leave=function(){this.options["<leave>"]=[{repeatable:true},function(){return false}];return this};Dialogue.prototype.getOption=function(key){return room.dialogue[this.entity.name].dialogue.options[key]||{key:key}};Dialogue.prototype.makeIcon=function(mood){var ret;ret=globals.ui.group.create(0,0,"sprites",["ui","emotes",mood].join("/"));ret.position.x-=ret.width;return ret};Dialogue.prototype.makeText=function(x,y,text){return new BmText(globals.ui.group,x,y,text,{maxWidth:200-x})};Dialogue.prototype.run=function(){if(this.state){return}Dialogue.__super__.run.apply(this,arguments);this.state=1;globals.ui.setLock(2);return this.setup()};Dialogue.prototype.setup=function(){var cb,config,fn,icon,key,option,ref,ref1,results,text,y;this.currentOptions=[];y=0;ref=this.options;fn=function(_this){return function(key,option,cb){return selectable(text,function(){var result;_this.setFlag(key);invoke(_this.currentOptions,"destroy");_this.chain=option.line?_this.player.blab(option.line):_this.player.chain();result=null;return _this.chain.link(function(){return result=typeof cb==="function"?cb():void 0}).link(function(){if(result===false){return _this["break"]()}else{return _this.setup()}}).run()})}}(this);results=[];for(key in ref){config=ref[key];ref1=config,config=ref1[0],cb=ref1[1];if(!this.shouldDisplay(key,config)){continue}option=this.getOption(key);icon=this.makeIcon(option.mood||"neutral");text=this.makeText(icon.width,y,option.key,option.nood||"neutral");text.hitbox.position.x=-icon.width;text.hitbox.scale.x=200;text.group.add(icon);this.currentOptions.push(text);fn(key,option,cb);results.push(y+=text.height)}return results};Dialogue.prototype.getFlag=function(key){return globals.flags.get(key,this.context)};Dialogue.prototype.setFlag=function(key,value){return globals.flags.set(key,this.context,value)};Dialogue.prototype.shouldDisplay=function(key,config){var count,flag,i,len,ref,ref1;if(config==null){config={}}if(!config.repeatable&&this.getFlag(key)){return false}if(config.ifFlags){count=(ref=config.ifFlagsCount)!=null?ref:config.ifFlags.length;ref1=config.ifFlags;for(i=0,len=ref1.length;i<len;i++){flag=ref1[i];if(this.getFlag(flag)){count-=1}}if(count>0){return false}}return true};Dialogue.prototype["break"]=function(){var ref;if((ref=this.chain)!=null){ref["break"]()}this.chain=null;globals.ui.setLock(0);return Dialogue.__super__["break"].apply(this,arguments)};return Dialogue}(LockUi)},{"../helper/get-dialogue":33,"../helper/invoke":35,"../helper/string-interpolation":39,"../ui/widgets/selectable":72,"./lock-ui":16}],15:[function(require,module,exports){var camelize,event,events,i,len,ret,slice=[].slice;camelize=require("camelize");events=[{name:"animate",module:require("./animate.coffee")},{name:"base",module:require("./base.coffee")},{name:"blab",module:require("./blab.coffee")},{name:"chain",module:require("./chain.coffee")},{name:"dialogue",module:require("./dialogue.coffee")},{name:"index",module:require("./index.coffee")},{name:"lock-ui",module:require("./lock-ui.coffee")},{name:"loop-animation",module:require("./loop-animation.coffee")},{name:"multi",module:require("./multi.coffee")},{name:"path-to",module:require("./path-to.coffee")},{name:"text",module:require("./text.coffee")},{name:"trigger",module:require("./trigger.coffee")},{name:"tween-path",module:require("./tween-path.coffee")},{name:"tween",module:require("./tween.coffee")},{name:"wait",module:require("./wait.coffee")}];ret={};for(i=0,len=events.length;i<len;i++){event=events[i];ret[event.name]=function(event){return function(){var args;args=1<=arguments.length?slice.call(arguments,0):[];if(args.length>4){console.error("Event attempted to construct with more than 4 argumments!")}return new event.module(args[0],args[1],args[2],args[3])}}(event)}module.exports=camelize(ret)},{"./animate.coffee":10,"./base.coffee":11,"./blab.coffee":12,"./chain.coffee":13,"./dialogue.coffee":14,"./index.coffee":15,"./lock-ui.coffee":16,"./loop-animation.coffee":17,"./multi.coffee":18,"./path-to.coffee":19,"./text.coffee":20,"./trigger.coffee":21,"./tween-path.coffee":22,"./tween.coffee":23,"./wait.coffee":24,camelize:2}],16:[function(require,module,exports){var LockUi,SceneEvent,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;SceneEvent=require("./base");module.exports=LockUi=function(superClass){extend(LockUi,superClass);function LockUi(lockLevel){this.lockLevel=lockLevel;LockUi.__super__.constructor.apply(this,arguments)}LockUi.prototype.run=function(){globals.ui.addLock(this.lockLevel);return LockUi.__super__.run.apply(this,arguments)};LockUi.prototype["break"]=function(){globals.ui.subLock();return LockUi.__super__["break"].apply(this,arguments)};return LockUi}(SceneEvent)},{"./base":11}],17:[function(require,module,exports){var LoopAnimation,Wait,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Wait=require("./wait");module.exports=LoopAnimation=function(superClass){extend(LoopAnimation,superClass);function LoopAnimation(sprite,animation,duration){this.sprite=sprite;this.animation=animation;this.duration=duration;LoopAnimation.__super__.constructor.call(this,this.duration)}LoopAnimation.prototype.run=function(){this.sprite.animations.play(this.animation,void 0,true);return LoopAnimation.__super__.run.apply(this,arguments)};return LoopAnimation}(Wait)},{"./wait":24}],18:[function(require,module,exports){var Event,MultiEvent,invoke,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Event=require("./base");invoke=require("../helper/invoke");module.exports=MultiEvent=function(superClass){extend(MultiEvent,superClass);function MultiEvent(events){this.events=events;this.counter=0}MultiEvent.prototype.run=function(){var callback,e,i,len,ref;callback=this.eventFinished.bind(this);ref=this.events;for(i=0,len=ref.length;i<len;i++){e=ref[i];e.run(callback)}return MultiEvent.__super__.run.apply(this,arguments)};MultiEvent.prototype["break"]=function(){invoke(this.events,"break");return MultiEvent.__super__["break"].apply(this,arguments)};MultiEvent.prototype.eventFinished=function(){this.counter++;if(this.counter>=this.events.length){return this.finish()}};return MultiEvent}(Event)},{"../helper/invoke":35,"./base":11}],19:[function(require,module,exports){var Path,PathTo,SceneEvent,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;SceneEvent=require("./base");Path=require("../ai/path");module.exports=PathTo=function(superClass){extend(PathTo,superClass);function PathTo(obj,dest,speed){this.obj=obj;this.dest=dest;this.speed=speed;PathTo.__super__.constructor.apply(this,arguments)}PathTo.prototype.run=function(){this.tween=room.findPath(this.obj,this.dest,this.speed).assign(this.obj,this.speed).run(this.finish.bind(this));return PathTo.__super__.run.apply(this,arguments)};PathTo.prototype["break"]=function(){var ref;if((ref=this.tween)!=null){ref["break"]()}return PathTo.__super__["break"].apply(this,arguments)};return PathTo}(SceneEvent)},{"../ai/path":8,"./base":11}],20:[function(require,module,exports){var Text,Wait,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Wait=require("./wait");module.exports=Text=function(superClass){extend(Text,superClass);function Text(x,y,content,opts){this.x=x;this.y=y;this.content=content;this.opts=opts;Text.__super__.constructor.call(this,this.opts.duration||1e3)}Text.prototype.run=function(){this.text=new BmText(globals.world,this.x,this.y,this.content,this.opts);return Text.__super__.run.apply(this,arguments)};Text.prototype["break"]=function(){var ref;if((ref=this.text)!=null){ref.destroy()}return Text.__super__["break"].apply(this,arguments)};return Text}(Wait)},{"./wait":24}],21:[function(require,module,exports){var SceneEvent,Trigger,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;SceneEvent=require("./base");module.exports=Trigger=function(superClass){extend(Trigger,superClass);function Trigger(trigger){this.trigger=trigger;Trigger.__super__.constructor.apply(this,arguments)}Trigger.prototype.update=function(){if(this.trigger()){return this.finish()}};return Trigger}(SceneEvent)},{"./base":11}],22:[function(require,module,exports){var Event,Tween,TweenPath,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Event=require("./base");Tween=require("./tween");module.exports=TweenPath=function(superClass){extend(TweenPath,superClass);function TweenPath(obj,prop,path,opts){this.obj=obj;this.prop=prop;this.path=path;if(opts==null){opts={}}TweenPath.__super__.constructor.apply(this,arguments);this.speed=opts.speed||1;this.absolute=opts.absolute;this.progress=0}TweenPath.prototype.run=function(){this.tween=new Tween(this,"progress",1,{speed:this.speed,absolute:true});this.tween.run(this.finish.bind(this));return TweenPath.__super__.run.apply(this,arguments)};TweenPath.prototype["break"]=function(){var ref;if((ref=this.tween)!=null){ref["break"]()}return TweenPath.__super__["break"].apply(this,arguments)};TweenPath.prototype.update=function(){return this.obj[this.prop]=game.math.bezierInterpolation(this.path,this.progress)};TweenPath.prototype.finish=function(){this.update();return TweenPath.__super__.finish.apply(this,arguments)};return TweenPath}(Event)},{"./base":11,"./tween":23}],23:[function(require,module,exports){var Event,Tween,passed,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Event=require("./base");passed=function(v,limit,sign){return sign>0&&v>=limit||sign<0&&v<=limit};module.exports=Tween=function(superClass){extend(Tween,superClass);function Tween(obj,prop,toValue,opts){this.obj=obj;this.prop=prop;this.toValue=toValue;

if(opts==null){opts={}}Tween.__super__.constructor.apply(this,arguments);this.fromValue=null;this.speed=opts.speed||1;this.absolute=opts.absolute}Tween.prototype.run=function(){this.fromValue=this.obj[this.prop];return Tween.__super__.run.apply(this,arguments)};Tween.prototype.update=function(){var increase;increase=Math.abs(this.absolute?this.speed:this.toValue-this.fromValue);increase*=game.time.elapsed/1e3*Math.sign(this.toValue-this.fromValue);if(!increase){this.finish()}this.obj[this.prop]+=increase;if(passed(this.obj[this.prop],this.toValue,increase)){this.obj[this.prop]=this.toValue;return this.finish()}};return Tween}(Event)},{"./base":11}],24:[function(require,module,exports){var SceneEvent,Wait,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;SceneEvent=require("./base");module.exports=Wait=function(superClass){extend(Wait,superClass);function Wait(duration){this.duration=duration!=null?duration:0;Wait.__super__.constructor.apply(this,arguments)}Wait.prototype.run=function(){this.startTime=Date.now();return Wait.__super__.run.apply(this,arguments)};Wait.prototype.update=function(){if(this.duration<=Date.now()-this.startTime){return this.finish()}};return Wait}(SceneEvent)},{"./base":11}],25:[function(require,module,exports){var Darkness,accessor1f,accessor2f,accessorDirect,get1f,get2f,getDirect,glsl,set1f,set2f,setDirect,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;glsl=require("./glsl/darkness");accessor2f=function(obj,name){return Object.defineProperty(obj,name,{get:get2f(name),set:set2f(name)})};get2f=function(name){return function(){var val;val=this.uniforms[name].value;return{x:val.x/SCALE,y:HEIGHT-this.uniforms[name].y/SCALE}}};set2f=function(name){return function(v){var val;val=this.uniforms[name].value;val.x=v.x*SCALE;return val.y=(HEIGHT-v.y)*SCALE}};accessor1f=function(obj,name){return Object.defineProperty(obj,name,{get:get1f(name),set:set1f(name)})};get1f=function(name){return function(){return this.uniforms[name].value*SCALE}};set1f=function(name){return function(v){return this.uniforms[name].value=v/SCALE}};accessorDirect=function(obj,name){return Object.defineProperty(obj,name,{get:getDirect(name),set:setDirect(name)})};getDirect=function(name){return function(){return this.uniforms[name].value}};setDirect=function(name){return function(v){return this.uniforms[name].value=v}};module.exports=Darkness=function(superClass){extend(Darkness,superClass);function Darkness(){Darkness.__super__.constructor.apply(this,arguments);window.darkness=this;this.uniforms.smallPos={type:"2f",value:{x:200,y:350}};this.uniforms.largePos={type:"2f",value:{x:100,y:40}};this.uniforms.smallAlpha={type:"1f",value:1};this.uniforms.largeAlpha={type:"1f",value:1};this.uniforms.smallFactor={type:"1f",value:.05};this.uniforms.largeFactor={type:"1f",value:.02};this.uniforms.flicker={type:"1f",value:.5};this.uniforms.ambientAlpha={type:"1f",value:0};this.fragmentSrc=[glsl]}accessor2f(Darkness.prototype,"smallPos");accessor2f(Darkness.prototype,"largePos");accessor1f(Darkness.prototype,"smallFactor");accessor1f(Darkness.prototype,"largeFactor");accessorDirect(Darkness.prototype,"smallAlpha");accessorDirect(Darkness.prototype,"largeAlpha");accessorDirect(Darkness.prototype,"ambientAlpha");return Darkness}(Phaser.Filter)},{"./glsl/darkness":27}],26:[function(require,module,exports){var Fakelines,glsl,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;glsl=require("./glsl/fakelines");module.exports=Fakelines=function(superClass){extend(Fakelines,superClass);function Fakelines(){Fakelines.__super__.constructor.apply(this,arguments);this.uniforms.hardness={type:"1f",value:2/5};this.uniforms.scale={type:"1f",value:2};this.fragmentSrc=[glsl]}return Fakelines}(Phaser.Filter)},{"./glsl/fakelines":28}],27:[function(require,module,exports){module.exports="precision mediump float;\r\nvarying vec2 vTextureCoord;\r\nuniform vec2 smallPos;\r\nuniform vec2 largePos;\r\nuniform float smallAlpha;\r\nuniform float smallFactor;\r\nuniform float largeAlpha;\r\nuniform float largeFactor;\r\nuniform float flicker;\r\nuniform float ambientAlpha;\r\nuniform vec4 date;\r\nuniform sampler2D uSampler;\r\n\r\n#define flickerLimit 0.2\r\n\r\nfloat light(float multiplier, vec2 coords){\r\n  vec2 dist = multiplier * coords;\r\n  dist = dist * dist;\r\n  float dist_mag = dist.x + dist.y;\r\n  return 1.0 - clamp(log(dist_mag), 0.0, 1.0);\r\n}\r\n\r\nvoid main(void){\r\n  vec4 color = texture2D(uSampler, vTextureCoord);\r\n  float small = light(smallFactor, vec2(gl_FragCoord) - smallPos);\r\n  float large = light(largeFactor, vec2(gl_FragCoord) - largePos);\r\n  float alpha = min(small*smallAlpha + large*largeAlpha, 1.0);\r\n\r\n  gl_FragColor = vec4(color.rgb * max(ambientAlpha, alpha), color.a);\r\n}\r\n\r\n"},{}],28:[function(require,module,exports){module.exports="precision mediump float;\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 vColor;\r\nuniform float hardness;\r\nuniform float scale;\r\nuniform sampler2D uSampler;\r\n\r\nvoid main(void) {\r\n  vec4 color = texture2D(uSampler, vTextureCoord);\r\n  float black = clamp(mod(-gl_FragCoord.y, scale) - scale * 0.33, 0.0, 1.0);\r\n\r\n  gl_FragColor = color * (1.0 - black * hardness);\r\n}\r\n"},{}],29:[function(require,module,exports){var Room;Room=require("../room");module.exports=function(name){var ref;if((ref=globals.room)!=null){ref.destroy()}return window.room=globals.room=new Room(globals.world,name)}},{"../room":47}],30:[function(require,module,exports){var Flags;module.exports=Flags=function(){function Flags(){this.flags={}}Flags.prototype.context=function(context){var base;if(context==null){context=room.path}return(base=this.flags)[context]||(base[context]={})};Flags.prototype.get=function(key,context){var ctx;ctx=this.context(context);return ctx[key]};Flags.prototype.set=function(key,context,value){var ctx;if(value==null){value=true}ctx=this.context(context);return ctx[key]=value};Flags.prototype.increment=function(key,context,diff){var ctx;if(diff==null){diff=1}ctx=this.context(context);ctx[key]||(ctx[key]=0);return ctx[key]+=value};Flags.prototype.toggle=function(key,context){var ctx;ctx=this.context(context);return ctx[key]=!ctx[key]};return Flags}()},{}],31:[function(require,module,exports){module.exports=function(a,b){var i,j,ref;if(a.length!==b.length){return false}if(!(Array.isArray(a)&&Array.isArray(b))){return false}for(i=j=0,ref=a.length;j<ref;i=j+=1){if(a[i]!==b[i]){return false}}return true}},{}],32:[function(require,module,exports){module.exports=function(str){return str[0].toUpperCase()+str.slice(1)}},{}],33:[function(require,module,exports){var defaults,getInventoryDialogue,interpolate,inventoryDialogue;interpolate=require("../helper/string-interpolation");defaults={gawk:"Nice @name@.",handle:"I don't know what to do with the @name@.",blab:"I don't think the @name@ could tell me much.","try":"I don't get how to use the @name@ with the $name$."};getInventoryDialogue=function(){var data;data=game.cache.getJSON("data");return data["ui/dialogue"]};inventoryDialogue=null;module.exports=function(context,name,key,obj,other){var dialogue,index,listIndexKey,listKey,ret,tryDialogue;inventoryDialogue||(inventoryDialogue=getInventoryDialogue());key||(key=name);dialogue=context==="room"?room.dialogue:context==="interactable"?room.dialogue[name]||{}:inventoryDialogue[name]||{};if(key==="try"){tryDialogue=room.dialogue[other!=null?other.name:void 0];ret=tryDialogue!=null?tryDialogue["try "+name]:void 0}ret||(ret=function(){if(dialogue[key]){return dialogue[key]}else if((listKey=key+" list")&&dialogue[listKey]){listIndexKey=key+" list index";if(this[listIndexKey]==null){this[listIndexKey]=0}index=Math.min(this[listIndexKey]++,dialogue[listKey].length-1);return dialogue[listKey][index]}else if(defaults[key]){return defaults[key]}else{debugger;return"I AM ERROR"}}.call(this));return interpolate(ret,obj,other)}},{"../helper/string-interpolation":39}],34:[function(require,module,exports){module.exports=function(){var hScale,vScale;hScale=window.innerWidth/WIDTH;vScale=window.innerHeight/HEIGHT;return window.SCALE=Math.max(1,Math.floor(Math.min(hScale,vScale)))}},{}],35:[function(require,module,exports){module.exports=function(arr,funcName){var a,i,len,ref;ref=arr.slice();for(i=0,len=ref.length;i<len;i++){a=ref[i];if(typeof a[funcName]==="function"){a[funcName]()}}return arr}},{}],36:[function(require,module,exports){module.exports=function(namespace,path){var components,i,key,len,name,names,ret,start;ret={};names=Object.keys(game.cache._cache.image.sprites.frameData._frameNames);start=namespace==="actor"?2:3;for(i=0,len=names.length;i<len;i++){name=names[i];components=name.split("/");if(!(namespace===components[0]&&path===components[1])){continue}key=components.slice(start,-1).join("/");key||(key=components[start]);if(!key){continue}(ret[key]||(ret[key]=[])).push(name)}return ret}},{}],37:[function(require,module,exports){var getScale;getScale=require("./get-scale");module.exports=function(scale){var height,width;window.SCALE=getScale();width=WIDTH*SCALE;height=HEIGHT*SCALE;this.world.scale.setTo(SCALE,SCALE);this.scanlines.uniforms.scale.value=SCALE;game.width=width;game.height=height;game.stage.width=width;game.stage.height=height;if(game.renderType===Phaser.WEBGL){return game.renderer.resize(width,height)}}},{"./get-scale":34}],38:[function(require,module,exports){module.exports=function(sprite,opts){var animation,frames,shouldLoop,speed;if(opts==null){opts={}}animation=opts.animation||sprite.animations.currentAnim;frames=animation._frames;speed=opts.speed||8;shouldLoop=opts.loop!=null?opts.loop:false;sprite.animations.add(opts.name||"forward",frames,speed,shouldLoop);return sprite.animations.add(opts.reverseName||"reverse",frames.slice().reverse(),speed,shouldLoop)}},{}],39:[function(require,module,exports){module.exports=function(string,obj,other){var attr,i,j,len,len1,match,ref,ref1;ref=string.match(/@.*?@/g)||[];for(i=0,len=ref.length;i<len;i++){match=ref[i];attr=match.slice(1,-1);string=string.replace(match,obj!=null?obj[attr]:void 0)}ref1=string.match(/\$.*?\$/g)||[];for(j=0,len1=ref1.length;j<len1;j++){match=ref1[j];attr=match.slice(1,-1);string=string.replace(match,other!=null?other[attr]:void 0)}return string}},{}],40:[function(require,module,exports){module.exports=function(touch){touch.$transformed=true;return touch.position.setTo(touch.position.x/SCALE,touch.position.y/SCALE)}},{}],41:[function(require,module,exports){var AUTO,Game,getScale;getScale=require("./helper/get-scale");require("./mixins");window.WIDTH=200;window.HEIGHT=120;window.SCALE=getScale();Game=Phaser.Game,AUTO=Phaser.AUTO;window.BmText=require("./ui/text");window.puts=console.log.bind(console);window.changeRoom=require("./globals/change-room");window.onload=function(){return window.game=new Game(WIDTH*SCALE,HEIGHT*SCALE,Phaser.AUTO,null,{preload:require("./preload"),create:require("./create"),update:require("./update")},false,false)}},{"./create":9,"./globals/change-room":29,"./helper/get-scale":34,"./mixins":42,"./preload":43,"./ui/text":71,"./update":73}],42:[function(require,module,exports){Math.sign||(Math.sign=function(v){if(v<0){return-1}else{return 1}})},{}],43:[function(require,module,exports){module.exports=function(){this.stage.disableVisbilityChange=true;this.load.atlasJSONHash("sprites","./build/image/sprites.png","./build/image/sprites.json");this.load.json("data","./build/assets/data.json");return this.load.audiosprite("sfx","./build/audio/sfx.ogg","./build/audio/sfx.json")}},{}],44:[function(require,module,exports){module.exports=function(path){var ctx,data,frame,i,img,j,k,l,pixSize,ref,ref1,ret;img=new Phaser.Image(game,0,0,"sprites",["room",path,"cmap"].join("/"));frame=img._frame;ctx=document.createElement("canvas").getContext("2d");ctx.drawImage(img.texture.baseTexture.source,frame.x,frame.y,frame.width,frame.height,0,0,frame.width,frame.height);data=ctx.getImageData(0,0,frame.width,frame.height);pixSize=data.data.length/(data.width*data.height);ret=[];for(j=k=0,ref=data.height;k<ref;j=k+=1){ret[j]=[];for(i=l=0,ref1=data.width;l<ref1;i=l+=1){ret[j][i]=!!data.data[(data.width*j+i)*pixSize]}}return ret}},{}],45:[function(require,module,exports){var Darkness,DarknessFilter,Interactable,filter,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Interactable=require("../interactable");DarknessFilter=require("../../filters/darkness");filter=new DarknessFilter;module.exports=Darkness=function(superClass){extend(Darkness,superClass);function Darkness(group,name){this.name=name;this.room=room;this.smallLight=1;this.largeLight=1;room.group.filters=[filter]}Darkness.prototype.update=function(){var pulse;filter.smallPos={x:player.pos.x,y:player.pos.y-24};filter.largePos={x:game.input.x/SCALE,y:game.input.y/SCALE};pulse=Math.sin(Date.now()/256);filter.smallFactor=.05+pulse/512;filter.largeFactor=.02;filter.smallAlpha=+this.smallLight;filter.largeAlpha=+this.largeLight;return filter.ambientAlpha=0};return Darkness}(Interactable)},{"../../filters/darkness":25,"../interactable":48}],46:[function(require,module,exports){var PlayerStart,Stefan;Stefan=require("../../actor/player/stefan");module.exports=PlayerStart=function(){function PlayerStart(group,name,animations,data){var Klass;this.name=name;Klass=window.currentPlayer||Stefan;window.player=new Klass(group);player.pos.setTo(data.x,data.y);player.orient(data)}return PlayerStart}()},{"../../actor/player/stefan":7}],47:[function(require,module,exports){var AStar,Interactable,Path,Room,invoke,makeCollision,makeFrames;Interactable=require("./interactable");AStar=require("a-star");Path=require("../ai/path");makeFrames=require("../helper/make-frames");makeCollision=require("./collision-map");invoke=require("../helper/invoke");module.exports=Room=function(){function Room(world,path){var data;this.path=path;window.room=this;this.sky=globals.world.add(game.add.image(0,0,"sprites",["room",this.path,"sky"].join("/")));this.group=world.add(game.add.group());this.bg=this.group.add(game.add.image(0,0,"sprites",["room",this.path,"background"].join("/")));this.sprites=game.add.group();data=game.cache.getJSON("data");this.dialogue=data[["room",this.path,"dialogue"].join("/")];this.entities=Interactable.create(this.path,this.sprites);this.sortEntities();this.group.add(this.sprites);this.collisionMap=makeCollision(this.path);this.pathFinder=new AStar(this.collisionMap)}Room.prototype.collisionGridSize=4;Room.prototype.sortEntities=function(){return this.sprites.sort("y",Phaser.Group.SORT_ASCENDING)};Room.prototype.findPath=function(start,end){return new Path(this.pathFinder,start,end,this.collisionGridSize)};Room.prototype.update=function(){return invoke(this.entities,"update")};Room.prototype.find=function(name){return this.entities.find(function(entity){return entity.name===name})};Room.prototype.remove=function(entity){var index,ref;index=this.entities.indexOf(entity);if(index>=0){this.entities.splice(index,1)}return(ref=entity.sprite)!=null?ref.destroy():void 0};Room.prototype.destroy=function(){invoke(this.entities,"destroy");this.group.filters=null;this.group.destroy();return this.sky.destroy()};return Room}()},{"../ai/path":8,"../helper/invoke":35,"../helper/make-frames":36,"./collision-map":44,"./interactable":48,"a-star":1}],48:[function(require,module,exports){var Interactable,events,getDialogue,klasses,makeFrames,slice=[].slice;makeFrames=require("../helper/make-frames");getDialogue=require("../helper/get-dialogue");events=require("../events");module.exports=Interactable=function(){Interactable.create=function(path,spriteGroup){var Klass,animation,animations,commonPath,data,fileName,klassPath,name,objData,ret;data=game.cache.getJSON("data");data=data[["room",path,"room"].join("/")];animations=makeFrames("room",path);ret=[];for(name in data){objData=data[name];fileName=name.replace(/\s/g,"-");animation=animations[fileName];klassPath=[path,fileName].join("/");commonPath=["common",fileName].join("/");Klass=klasses[klassPath]||klasses[commonPath]||this;if(animation||Klass!==this){ret.push(new Klass(spriteGroup,name,animation,objData))}else{console.error("Failed to find animation or class for: "+name)}}return ret};function Interactable(group,name1,animation,data){var k,ref,v;this.name=name1;for(k in data){v=data[k];this[k]=v}if(this.pickup&&!Array.isArray(this.pickup)){this.pickup=[this.pickup]}this.pickup=(ref=this.pickup)!=null?ref.map(function(_this){return function(pickup){if(pickup===true){return _this.name}else{return pickup}}}(this)):void 0;this.zoff||(this.zoff=0);this.sprite=group.create(data.x,data.y-this.zoff,"sprites");this.sprite.obj=this;this.pos=this.sprite.position;this.sprite.pivot.setTo(data.xoff,data.yoff-this.zoff);this.sprite.animations.add(this.name,animation,data.animspeed||8,!!data.loop);this.sprite.animations.play(this.name);this.sprite.inputEnabled=true;this.sprite.input.pixelPerfectOver=true;this.sprite.input.useHandCursor=true}Interactable.prototype.getDialogue=function(key,other,context){if(context==null){context="interactable"}return getDialogue(context,this.name,key,this,other)};Interactable.prototype.frolic=function(player){return events.chain().link(player.frolic(this.blabx?this.blabPosition:this.pos)).link(function(_this){return function(){return player.orient(_this)}}(this))};Interactable.prototype.action=function(){var action,args,player,response;action=arguments[0],player=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];if(this[action]){response=this[action].apply(this,[player].concat(slice.call(args)));if(response!==false){return response}}return player.blab(this.getDialogue(action))};Interactable.prototype["try"]=function(player,item){if(this.pickup){return this.handle(player).link(function(_this){return function(){return _this.tryPickups(player,item)}}(this))}else{return player.blab(item.getDialogue("try",this))}};Interactable.prototype.handle=function(player){if(this.pickup){return player.handle(this,this.getPickedUp.bind(this))}else{return false}};Interactable.prototype.getPickedUp=function(){var i,len,pickup,ref;ref=this.pickup;for(i=0,len=ref.length;i<len;i++){pickup=ref[i];globals.ui.inventory.add(pickup)}return this.destroy()};Interactable.prototype.tryPickups=function(player,item){var i,len,pickup,ref,ret;ret=events.chain();ref=this.pickup;for(i=0,len=ref.length;i<len;i++){pickup=ref[i];pickup=globals.ui.inventory.find(pickup);if(pickup){ret.link(pickup.action("try",player,item))}}return ret};Interactable.prototype.destroy=function(){return room.remove(this)};Interactable.prototype.animate=function(animation,frameCallback,callbackFrame){return events.animate(this.sprite,animation,frameCallback,callbackFrame)};Object.defineProperty(Interactable.prototype,"blabPosition",{get:function(){return{x:this.blabx,y:this.blaby}}});return Interactable}();klasses={"collision-map":require("./collision-map.coffee"),"common/darkness":require("./common/darkness.coffee"),"common/start":require("./common/start.coffee"),index:require("./index.coffee"),interactable:require("./interactable.coffee"),"stefans-garden/script":require("./stefans-garden/script.coffee"),"stefans-garden/shadow":require("./stefans-garden/shadow.coffee"),"stefans-room/closet-door":require("./stefans-room/closet-door.coffee"),"stefans-room/darkness":require("./stefans-room/darkness.coffee"),"stefans-room/light-switch":require("./stefans-room/light-switch.coffee"),"stefans-room/outside-door":require("./stefans-room/outside-door.coffee"),"stefans-room/phone":require("./stefans-room/phone.coffee"),"stefans-room/safe":require("./stefans-room/safe.coffee"),"stefans-room/script":require("./stefans-room/script.coffee"),"stefans-room/shadow":require("./stefans-room/shadow.coffee"),"stefans-room/television":require("./stefans-room/television.coffee")};puts(klasses)},{"../events":15,"../helper/get-dialogue":33,"../helper/make-frames":36,"./collision-map.coffee":44,"./common/darkness.coffee":45,"./common/start.coffee":46,"./index.coffee":47,"./interactable.coffee":48,"./stefans-garden/script.coffee":49,"./stefans-garden/shadow.coffee":50,"./stefans-room/closet-door.coffee":51,"./stefans-room/darkness.coffee":52,"./stefans-room/light-switch.coffee":53,"./stefans-room/outside-door.coffee":54,"./stefans-room/phone.coffee":55,"./stefans-room/safe.coffee":56,"./stefans-room/script.coffee":57,"./stefans-room/shadow.coffee":58,"./stefans-room/television.coffee":59}],49:[function(require,module,exports){var StefansGardenScript,events;events=require("../../events");module.exports=StefansGardenScript=function(){function StefansGardenScript(){setTimeout(this.run.bind(this))}StefansGardenScript.prototype.run=function(){return events.chain().link(events.trigger(function(){return player.pos.x<=135})).link(function(){player["break"]();return room.find("shadow").action("blab",player)}).run()};return StefansGardenScript}()},{"../../events":15}],50:[function(require,module,exports){var Interactable,Shadow,events,reverseAnimation,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Interactable=require("../interactable");reverseAnimation=require("../../helper/reverse-animation");events=require("../../events");module.exports=Shadow=function(superClass){extend(Shadow,superClass);function Shadow(){Shadow.__super__.constructor.apply(this,arguments);reverseAnimation(this.sprite);this.wobbleCb=this.wobble.bind(this);setTimeout(function(_this){return function(){return _this.chain=_this.wobble().run()}}(this))}Shadow.prototype.states=["forward","reverse"];Shadow.prototype.wobble=function(){this.state=!this.state;return events.chain().link(events.animate(this.sprite,this.states[+this.state])).link(events.wait(1e3)).link(this.wobbleCb)};Shadow.prototype.handle=function(player){return player.blab(this.getDialogue("handle")).link(function(){return globals.flags.set("hostile attitude")}).link(this.blab(player))};Shadow.prototype["try"]=function(player,item){var ret;ret=Shadow.__super__["try"].apply(this,arguments);switch(item.name){case"mashiro":case"kojin":return ret.link(function(){return globals.flags.set("hostile attitude")}).link(this.blab(player));default:return ret}};Shadow.prototype.blab=function(player){return player.cutscene(2).link(this.frolic(player)).link(function(_this){return function(){return player.dialogue(_this).option("question").option("convince").option("dismiss").option("threaten",{ifFlags:["question","convince","dismiss"],ifFlagsCount:1-!!globals.flags.get("hostile attitude")},function(){return false}).option("get attention",{ifFlags:["question","convince","dismiss"],ifFlagsCount:2},function(){return false})}}(this))};Shadow.prototype.destroy=function(){Shadow.__super__.destroy.apply(this,arguments);return this.chain["break"]()};return Shadow}(Interactable)},{"../../events":15,"../../helper/reverse-animation":38,"../interactable":48}],51:[function(require,module,exports){var ClosetDoor,Interactable,reverseAnimation,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Interactable=require("../interactable");reverseAnimation=require("../../helper/reverse-animation");module.exports=ClosetDoor=function(superClass){extend(ClosetDoor,superClass);function ClosetDoor(){ClosetDoor.__super__.constructor.apply(this,arguments);this.isOpen=false;this.sprite.animations.stop();reverseAnimation(this.sprite,{name:"open",reverseName:"close"})}ClosetDoor.prototype.states=["close","open"];ClosetDoor.prototype.handle=function(player){this.isOpen=!this.isOpen;return player.handle(this,[0,this.animate(this.states[+this.isOpen])])};return ClosetDoor}(Interactable)},{"../../helper/reverse-animation":38,"../interactable":48}],52:[function(require,module,exports){var CommonDarkness,Darkness,Stefan,events,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;CommonDarkness=require("../common/darkness");Stefan=require("../../actor/player/stefan-no-cigarette");events=require("../../events");module.exports=Darkness=function(superClass){extend(Darkness,superClass);function Darkness(group,name){var height,width;Darkness.__super__.constructor.apply(this,arguments);this.smallLight=0;this.largeLight=0;width=200;height=70;this.sprite=group.create(0,0,"sprites","empty");this.sprite.obj=this;this.sprite.inputEnabled=true;this.sprite.input.useHandCursor=true;this.sprite.scale.setTo(width,height);this.pos=this.sprite.position}Darkness.prototype.frolic=function(player){return player.blab(this.getDialogue("frolic"))};Darkness.prototype["try"]=function(player,item){if(item.name!=="matches"){return false}return this.lightMatch(player)};Darkness.prototype.lightMatch=function(player){this.sprite.destroy();events.tween(this,"smallLight",1,{speed:.2}).run();room.sortEntities();return player.cutscene().link(function(){room.sprites.add(player.sprite);room.sortEntities();globals.sfx.play("matches");return player.animate("match-start")}).link(function(){return window.player=player.replaceWith(new Stefan(room.sprites))})};Darkness.prototype.update=function(){var ref;Darkness.__super__.update.apply(this,arguments);return(ref=this.sprite)!=null?ref.bringToTop():void 0};return Darkness}(CommonDarkness)},{"../../actor/player/stefan-no-cigarette":6,"../../events":15,"../common/darkness":45}],53:[function(require,module,exports){var Interactable,LightSwitch,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Interactable=require("../interactable");module.exports=LightSwitch=function(superClass){extend(LightSwitch,superClass);function LightSwitch(){LightSwitch.__super__.constructor.apply(this,arguments);this.states=this.sprite.animations.currentAnim._frames;this.flipCb=this.flip.bind(this)}LightSwitch.prototype.handle=function(player){var ret;ret=player.handle(this,this.flipCb).link(function(){return globals.flags.set("tried light switch",room.path)}).link(player.blab(this.getDialogue("handle")));if(globals.flags.get("tried television",room.path)){ret.link(player.blab(this.getDialogue("no power",null,"room")))}return ret};LightSwitch.prototype.flip=function(){globals.sfx.play("switch");return this.sprite.animations.frame=this.states[1-this.states.indexOf(this.sprite.animations.frame)]};return LightSwitch}(Interactable)},{"../interactable":48}],54:[function(require,module,exports){var ClosetDoor,OutsideDoor,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;ClosetDoor=require("./closet-door");module.exports=OutsideDoor=function(superClass){extend(OutsideDoor,superClass);function OutsideDoor(){return OutsideDoor.__super__.constructor.apply(this,arguments)}OutsideDoor.prototype.gawk=function(player){if(room.find("shadow")){return false}return player.blab(this.getDialogue("gawk no shadow"))};OutsideDoor.prototype.handle=function(player){var flashlight,swords;flashlight=globals.ui.inventory.find("flashlight");swords=globals.ui.inventory.find("mashiro");if(flashlight&&swords){return player.frolic(this.pos).link(player.handle(this,this.swingOpen.bind(this))).link(player.blab(this.getDialogue("handle exit"))).link(function(){return changeRoom("stefans-garden")})}else if(flashlight){return player.blab(this.getDialogue("handle have flashlight"))}else{return false}};OutsideDoor.prototype.swingOpen=function(){return this.sprite.animations.play("open")};return OutsideDoor}(ClosetDoor)},{"./closet-door":51}],55:[function(require,module,exports){var Interactable,Phone,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Interactable=require("../interactable");module.exports=Phone=function(superClass){extend(Phone,superClass);function Phone(){return Phone.__super__.constructor.apply(this,arguments)}Phone.prototype.blab=function(player){return this.handle(player).link(function(_this){return function(){return globals.ui.inventory.find(_this.pickup[0]).action("blab",player)}}(this))};return Phone}(Interactable)},{"../interactable":48}],56:[function(require,module,exports){var Interactable,Safe,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Interactable=require("../interactable");module.exports=Safe=function(superClass){extend(Safe,superClass);function Safe(){return Safe.__super__.constructor.apply(this,arguments)}Safe.prototype["try"]=function(player,item){switch(false){case!this.isOpen:return false;case!(item.name==="lockpicks"&&player.name==="stefan-no-cigarette"):return player.blab(this.getDialogue("need hands"));case item.name!=="lockpicks":return player.work(this).link(function(_this){return function(){_this.destroy();globals.ui.inventory.add("padlock");room.find("shadow").destroy();return player.blab(_this.getDialogue("opened"))}}(this));default:debugger;return false}};return Safe}(Interactable)},{"../interactable":48}],57:[function(require,module,exports){var StefanDarkness,StefansRoomScript,getDialogue;StefanDarkness=require("../../actor/player/stefan-darkness");getDialogue=require("../../helper/get-dialogue");module.exports=StefansRoomScript=function(){function StefansRoomScript(){this.name="script";this.stefan=window.player=new StefanDarkness(globals.world);this.stefan.pos.setTo(100,64);if(!globals.ui.inventory.find("matches")){globals.ui.inventory.add("matches")}setTimeout(this.intro.bind(this))}StefansRoomScript.prototype.intro=function(){return this.stefan.blab(getDialogue("room","intro")).run()};StefansRoomScript.prototype.destroy=function(){var ref;return(ref=this.stefan)!=null?ref.destroy():void 0};return StefansRoomScript}()},{"../../actor/player/stefan-darkness":5,"../../helper/get-dialogue":33}],58:[function(require,module,exports){var Interactable,Shadow,events,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;

child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Interactable=require("../interactable");events=require("../../events");module.exports=Shadow=function(superClass){extend(Shadow,superClass);function Shadow(){this.knockIndex=0;Shadow.__super__.constructor.apply(this,arguments);this.knockCb=this.knockCycle.bind(this);setTimeout(this.knockCb)}Shadow.prototype.knockCycle=function(){return this.currentCycle=events.chain().link(function(_this){return function(){return _this.knock(0)}}(this)).link(events.wait(500)).link(function(_this){return function(){return _this.knock(1)}}(this)).link(events.wait(500)).link(function(_this){return function(){return _this.knock(2)}}(this)).link(events.wait(4e3)).link(this.knockCb).run()};Shadow.prototype.knock=function(i){globals.sfx.play("knock-glass"+(i+1));return events.text(10+10*i,20+5*i,"KNOCK",{tint:6881128})};Shadow.prototype.handle=function(player){if(globals.ui.inventory.find("mashiro")){return player.blab(this.getDialogue("try mashiro"))}else{return false}};Shadow.prototype.destroy=function(){var ref;Shadow.__super__.destroy.apply(this,arguments);return(ref=this.currentCycle)!=null?ref["break"]():void 0};return Shadow}(Interactable)},{"../../events":15,"../interactable":48}],59:[function(require,module,exports){var Interactable,Television,playSfx,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Interactable=require("../interactable");playSfx=function(){return globals.sfx.play("switch")};module.exports=Television=function(superClass){extend(Television,superClass);function Television(){return Television.__super__.constructor.apply(this,arguments)}Television.prototype.handle=function(player){var ret;ret=player.handle(this,playSfx).link(function(){return globals.flags.set("tried television",room.path)}).link(player.blab(this.getDialogue("handle")));if(globals.flags.get("tried light switch",room.path)){ret.link(player.blab(this.getDialogue("no power",null,"room")))}return ret};return Television}(Interactable)},{"../interactable":48}],60:[function(require,module,exports){var UiAction;module.exports=UiAction=function(){function UiAction(group,name){this.name=name;this.sprite=group.create(0,0,"sprites","ui/hud/actions/"+this.name);this.sprite.inputEnabled=true;this.sprite.input.useHandCursor=true;this.sprite.obj=this;this.fullName=function(){switch(this.name){case"blab":return"blab to";case"gawk":return"gawk at";default:return this.name}}.call(this);this.pos=this.sprite.position}UiAction.prototype.select=function(){this.sprite.tint=function(){switch(this.name){case"blab":return 16711935;case"gawk":return 65535;default:return 16776960}}.call(this);return this};UiAction.prototype.cancel=function(){this.sprite.tint=16777215;return this};return UiAction}()},{}],61:[function(require,module,exports){var UiAction,UiActions;UiAction=require("./action");module.exports=UiActions=function(){function UiActions(group){var action,i,j,key,len,len1,obj,ref,ref1;this.group=game.add.group();this.pos=this.group.position;this.width=0;this.height=0;this.actions=[];group.add(this.group);ref=["gawk","handle","blab"];for(i=0,len=ref.length;i<len;i++){action=ref[i];obj=new UiAction(this.group,action);this.actions.push(obj);obj.pos.y=this.height;this.width=obj.sprite.width;this.height+=obj.sprite.height}this.frolic={name:"frolic",fullName:"frolic"};this["try"]={name:"try",fullName:"try"};this.select={name:"select",fullName:"try"};this.unselect={name:"unselect",fullName:"try"};this.actions.concat([this.frolic,this["try"],this.select,this.unselect]);ref1="GHBF ";for(j=0,len1=ref1.length;j<len1;j++){key=ref1[j];game.input.keyboard.addKey(key.charCodeAt()).onDown.add(this.selectFromKey,this)}}UiActions.prototype.selectFromKey=function(key){var letter;if(globals.isControlsLocked){return}letter=String.fromCharCode(key.keyCode).toLowerCase();return this.selected=this.actions.find(function(action){return action.name[0]===letter})};Object.defineProperty(UiActions.prototype,"selected",{get:function(){var action,inventory;action=globals.ui.info.action;inventory=globals.ui.inventory;switch(false){case!action:return action;case!(inventory.selected&&inventory.selected===inventory.hover):return this.unselect;case!inventory.selected:return this["try"];case!inventory.hover:return this.select;default:return this.frolic}},set:function(action){var ref;if((action!=null?action.name:void 0)==="frolic"||action===this.selected){action=null}if((ref=this.selected)!=null){if(typeof ref.cancel==="function"){ref.cancel()}}globals.ui.info.action=action;globals.ui.inventory.selected=null;return action!=null?typeof action.select==="function"?action.select():void 0:void 0}});Object.defineProperty(UiActions.prototype,"name",{get:function(){var ref;return(ref=this.selected)!=null?ref.name:void 0},set:function(name){return this.selected=this.actions.find(function(action){return action.name===name})}});Object.defineProperty(UiActions.prototype,"hover",{get:function(){return globals.ui.info.hoverAction},set:function(action){return globals.ui.info.hoverAction=action}});Object.defineProperty(UiActions.prototype,"any",{get:function(){return this.hover||this.selected}});return UiActions}()},{"./action":60}],62:[function(require,module,exports){var Actions,Info,Inventory,Ui,transformPosition;transformPosition=require("../helper/transform-position");Info=require("./info");Actions=require("./actions");Inventory=require("./inventory");module.exports=Ui=function(){function Ui(group){this.group=game.add.group();this.pos=this.group.position;this.info=new Info(this.group);this.actions=new Actions(this.group);this.inventory=new Inventory(this.group);group.add(this.group);this.actions.pos.setTo(0,this.info.height);this.inventory.pos.setTo(this.actions.width,this.info.height);game.input.addMoveCallback(this.onHover,this);game.input.onDown.add(this.onClick,this)}Ui.prototype.onHover=function(pointer){if(globals.isControlsLocked){return}this.info.obj=this.itemAt(room.sprites,pointer);this.actions.hover=this.itemAt(this.actions.group,pointer);this.inventory.hover=this.itemAt(this.inventory.group,pointer);return transformPosition(pointer)};Ui.prototype.onClick=function(pointer){var ref;if(globals.isControlsLocked){return}if(this.actions.hover){return this.actions.selected=this.info.hoverAction}else if(this.inventory.hover){return(ref=this.inventory.hover.action(this.actions.selected.name,player,this.inventory.selected))!=null?typeof ref.run==="function"?ref.run():void 0:void 0}};Ui.prototype.itemAt=function(collection,pointer){var i,item,ref,ref1,ret;ref=collection.children;for(i=ref.length-1;i>=0;i+=-1){item=ref[i];if(-1<((ref1=item.input)!=null?ref1.overDuration(pointer.id):void 0)){ret=item.obj}if(item.children){ret||(ret=this.itemAt(item,pointer))}if(ret){return ret}}};Ui.prototype.setLock=function(lock){if(lock==null){lock=1}globals.isControlsLocked=lock;this.actions.group.visible=this.inventory.group.visible=!lock;if(lock>1){return this.info.group.visible=false}else{return this.info.group.alpha=1/(1+lock)}};Ui.prototype.lock=function(){return this.setLock(true)};Ui.prototype.unlock=function(){return this.setLock(false)};Ui.prototype.addLock=function(min){if(min==null){min=1}globals.isControlsLocked||(globals.isControlsLocked=0);return this.setLock(Math.max(min,globals.isControlsLocked))};Ui.prototype.subLock=function(){return this.setLock(Math.max(0,globals.isControlsLocked-1))};return Ui}()},{"../helper/transform-position":40,"./actions":61,"./info":63,"./inventory":66}],63:[function(require,module,exports){var UiInfo;module.exports=UiInfo=function(){function UiInfo(group){this.group=game.add.group();this.pos=this.group.position;group.add(this.group);this.width=200;this.height=10;this.text=new BmText(this.group,100,0,"",{anchor:[.5,0]})}UiInfo.prototype.updateText=function(){var action,obj,parts,ret;parts=[];action=globals.ui.actions.any;if(!(this.inv&&this.inv===this.hoverInv)){obj=this.hoverInv||this.obj}parts.push(action.fullName);if(this.inv){parts.push(this.inv.name)}if(action.name==="try"){parts.push("on")}if(obj){parts.push(obj.name)}if(obj&&action.name==="frolic"){parts[parts.length-1]+="-wards"}ret=parts.join(" ");return this.text.content=ret&&ret[0].toUpperCase()+ret.slice(1)};["obj","inv","action","hoverAction","hoverInv"].forEach(function(prop){var key;key="_"+prop;return Object.defineProperty(UiInfo.prototype,prop,{get:function(){return this[key]},set:function(value){if(this[key]===value){return}this[key]=value;return this.updateText()}})});return UiInfo}()},{}],64:[function(require,module,exports){var InventoryBullseye,Item,Stefan,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Item=require("./item");Stefan=require("../../actor/player/stefan");module.exports=InventoryBullseye=function(superClass){extend(InventoryBullseye,superClass);function InventoryBullseye(){return InventoryBullseye.__super__.constructor.apply(this,arguments)}InventoryBullseye.prototype.handle=function(player){if(player.name==="stefan"){return player.blab(this.getDialogue("not finished"))}else{return false}};InventoryBullseye.prototype["try"]=function(player,item){if(item.name==="matches"&&player.name==="stefan-no-cigarette"){return this.lightCigarette(player)}else if(item.name==="matches"){return player.blab(this.getDialogue("not finished"))}else{return InventoryBullseye.__super__["try"].apply(this,arguments)}};InventoryBullseye.prototype.lightCigarette=function(player){player.matchHand.visible=false;return player.cutscene().link(player.animate("cigarette-start")).link(player.loop("cigarette-loop",500)).link(player.animate("cigarette-stop")).link(function(){return window.player=player.replaceWith(new Stefan(room.sprites))})};return InventoryBullseye}(Item)},{"../../actor/player/stefan":7,"./item":67}],65:[function(require,module,exports){var InventoryFlashlight,Item,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Item=require("./item");module.exports=InventoryFlashlight=function(superClass){extend(InventoryFlashlight,superClass);function InventoryFlashlight(){return InventoryFlashlight.__super__.constructor.apply(this,arguments)}InventoryFlashlight.prototype.handle=function(player){var darkness;darkness=room.find("darkness");if(!darkness){return false}darkness.largeLight=!darkness.largeLight};return InventoryFlashlight}(Item)},{"./item":67}],66:[function(require,module,exports){var Slot,UiInventory;Slot=require("./slot");module.exports=UiInventory=function(){function UiInventory(group){var i,j,posX,posY,slot;this.group=game.add.group();this.pos=this.group.position;this.slots=[];group.add(this.group);posX=0;posY=0;for(i=j=0;j<10;i=++j){slot=new Slot(this.group,posX,posY);posX+=slot.sprite.width;this.slots.push(slot);if(posX>=160){posX=0;posY+=slot.sprite.height}}game.input.keyboard.addKey(" ".charCodeAt()).onDown.add(function(_this){return function(){return _this.selected=null}}(this))}UiInventory.prototype.freeSlot=function(){return this.slots.find(function(slot){return!slot.item})};UiInventory.prototype.add=function(itemName){return this.freeSlot().insert(itemName)};UiInventory.prototype.find=function(itemName){var j,len,ref,ref1,slot;ref=this.slots;for(j=0,len=ref.length;j<len;j++){slot=ref[j];if(((ref1=slot.item)!=null?ref1.name:void 0)===itemName){return slot.item}}};Object.defineProperty(UiInventory.prototype,"selected",{get:function(){return globals.ui.info.inv},set:function(item){var ref;if((ref=this.selected)!=null){ref.slot.cancel()}globals.ui.info.inv=item;return item!=null?item.slot.select():void 0}});Object.defineProperty(UiInventory.prototype,"hover",{get:function(){return globals.ui.info.hoverInv},set:function(item){return globals.ui.info.hoverInv=item}});Object.defineProperty(UiInventory.prototype,"any",{get:function(){return this.hover||this.selected}});return UiInventory}()},{"./slot":70}],67:[function(require,module,exports){var UiInventoryItem,getDialogue,slice=[].slice;getDialogue=require("../../helper/get-dialogue");module.exports=UiInventoryItem=function(){function UiInventoryItem(group,name){this.name=name;this.sprite=group.create(0,0,"sprites","ui/inventory/"+this.name);this.sprite.inputEnabled=true;this.sprite.input.useHandCursor=true;this.sprite.obj=this}UiInventoryItem.prototype.getDialogue=function(key,other){return getDialogue("inventory",this.name,key,this,other)};UiInventoryItem.prototype.select=function(){return globals.ui.inventory.selected=this};UiInventoryItem.prototype.unselect=function(){globals.ui.inventory.selected=null;return this};UiInventoryItem.prototype.action=function(){var action,args,player,response;action=arguments[0],player=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];if(this[action]){response=this[action].apply(this,[player].concat(slice.call(args)));if(response!==false){return response}}return player.blab(this.getDialogue(action))};UiInventoryItem.prototype["try"]=function(player,item,fallback){var result;if(fallback==null){fallback=true}if(fallback){result=item["try"](player,this,false);if(result===false){return player.blab(item.getDialogue("try",this))}else{return result}}else{return false}};return UiInventoryItem}()},{"../../helper/get-dialogue":33}],68:[function(require,module,exports){var InventoryMatches,Item,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Item=require("./item");module.exports=InventoryMatches=function(superClass){extend(InventoryMatches,superClass);function InventoryMatches(){return InventoryMatches.__super__.constructor.apply(this,arguments)}InventoryMatches.prototype.handle=function(player){if(player.name==="stefan-darkness"){return room.find("darkness")["try"](player,this)}else{return false}};return InventoryMatches}(Item)},{"./item":67}],69:[function(require,module,exports){var Item,Phone,events,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Item=require("./item");events=require("../../events");module.exports=Phone=function(superClass){extend(Phone,superClass);function Phone(){return Phone.__super__.constructor.apply(this,arguments)}Phone.prototype.handle=function(player){var phoneTone,ret,sound;sound="phone-tone";phoneTone=globals.sfx.sounds[sound];ret=player.cutscene().link(player.animate("phone-start")).link(function(){player.animations.play("phone");return phoneTone.play(sound,null,1,true)}).link(events.wait(2e3)).link(function(){player.overlay.visible=true;return player.overlay.animations.play("blab-head")}).link(events.blab(this.getDialogue("blab"))).link(function(){player.overlay.visible=false;return phoneTone.stop()}).link(player.animate("phone-stop")).ensure(function(){phoneTone.stop();return player.overlay.visible=false});if(player.matchHand){player.matchHand.visible=false;ret.linkLeft(player.animate("match-stop")).link(player.animate("match-start")).link(function(){return player.matchHand.visible=true})}return ret};Phone.prototype.blab=function(player){return this.handle(player)};return Phone}(Item)},{"../../events":15,"./item":67}],70:[function(require,module,exports){var Item,UiInventorySlot,frame,klasses;Item=require("./item");frame=function(name){return["ui","hud","inventory",name].join("/")};module.exports=UiInventorySlot=function(){function UiInventorySlot(group,x,y){this.group=game.add.group();group.add(this.group);this.pos=this.group.position;this.pos.setTo(x,y);this.sprite=this.group.create(0,0,"sprites",frame("slot"));this.sprite.inputEnabled=true;this.item=null}UiInventorySlot.prototype.insert=function(itemName){var Klass,fileName;fileName=itemName.replace(/\s/g,"-");Klass=klasses[fileName]||Item;this.item=new Klass(this.group,itemName);return this.item.slot=this};UiInventorySlot.prototype.free=function(){var ref;return this.group.remove((ref=this.item)!=null?ref.sprite:void 0)};UiInventorySlot.prototype.select=function(){return this.sprite.frameName=frame("selected")};UiInventorySlot.prototype.cancel=function(){return this.sprite.frameName=frame("slot")};return UiInventorySlot}();klasses={bullseye:require("./bullseye.coffee"),flashlight:require("./flashlight.coffee"),index:require("./index.coffee"),item:require("./item.coffee"),matches:require("./matches.coffee"),phone:require("./phone.coffee"),slot:require("./slot.coffee")};puts(klasses)},{"./bullseye.coffee":64,"./flashlight.coffee":65,"./index.coffee":66,"./item":67,"./item.coffee":67,"./matches.coffee":68,"./phone.coffee":69,"./slot.coffee":70}],71:[function(require,module,exports){var SPACE_WIDTH,Text,Word;SPACE_WIDTH=2;Word=function(){function Word(group,string){var char,i,image,key,len;this.group=game.add.group();this.pos=this.group.position;this.width=0;this.height=0;group.add(this.group);for(i=0,len=string.length;i<len;i++){char=string[i];key=["ui","font",char].filter(function(a){return a}).join("/");image=game.add.image(this.width,0,"sprites",key);this.group.add(image);this.width+=image.width;this.height=image.height}}return Word}();module.exports=Text=function(){function Text(group,x,y,content,config){if(content==null){content=""}if(config==null){config={}}this.maxWidth=config.maxWidth;this.anchor=config.anchor||[0,0];this.group=game.add.group();this.pos=this.group.position;this.content=content;group.add(this.group);this.pos=this.group.position;this.pos.setTo(x,y);if(config.tint){this.tint=config.tint}}Text.prototype.buildText=function(){var i,len,ref,word,words,x,y;if((ref=this.alignGroup)!=null){ref.destroy(true)}this.alignGroup=game.add.group();this.group.add(this.alignGroup);x=0;y=0;words=this._content.split(/\s/g).map(function(_this){return function(word){return new Word(_this.alignGroup,word)}}(this));this.width=0;this.height=0;for(i=0,len=words.length;i<len;i++){word=words[i];this.height=Math.max(this.height,y+word.height);if(x>0&&x+word.width>(this.maxWidth||Infinity)){x=0;y+=word.height}word.pos.setTo(x,y);this.width=Math.max(this.width,x+word.width);x+=word.width+SPACE_WIDTH}this.alignGroup.position.setTo(this.width*-this.anchor[0],this.height*-this.anchor[1]);this.hitbox=this.alignGroup.create(0,0,"sprites","empty");return this.hitbox.scale.setTo(this.width,this.height)};Object.defineProperty(Text.prototype,"content",{get:function(){return this._content},set:function(value){this._content=value;return this.buildText()}});Object.defineProperty(Text.prototype,"tint",{get:function(){return this._tint||16777215},set:function(value){var i,len,letter,ref,results,word;this._tint=value;ref=this.alignGroup.children;results=[];for(i=0,len=ref.length;i<len;i++){word=ref[i];results.push(function(){var j,len1,ref1,results1;ref1=word.children;results1=[];for(j=0,len1=ref1.length;j<len1;j++){letter=ref1[j];results1.push(letter.tint=value)}return results1}())}return results}});Object.defineProperty(Text.prototype,"inputEnabled",{get:function(){return this.hitbox.inputEnabled},set:function(value){return this.hitbox.inputEnabled=value}});Object.defineProperty(Text.prototype,"input",{get:function(){return this.hitbox.input}});Object.defineProperty(Text.prototype,"events",{get:function(){return this.hitbox.events}});Object.defineProperty(Text.prototype,"alpha",{get:function(){return this.group.alpha},set:function(value){return this.group.alpha=value}});Text.prototype.destroy=function(){return this.group.destroy(true)};return Text}()},{}],72:[function(require,module,exports){module.exports=function(sprite,callback){sprite.alpha=.5;sprite.inputEnabled=true;sprite.input.useHandCursor=true;sprite.events.onInputOver.add(function(){return sprite.alpha=1});sprite.events.onInputOut.add(function(){return sprite.alpha=.5});return sprite.events.onInputDown.add(callback)}},{}],73:[function(require,module,exports){var invoke;invoke=require("./helper/invoke");module.exports=function(a){invoke(this.events,"update");return globals.room.update()}},{"./helper/invoke":35}]},{},[41]);